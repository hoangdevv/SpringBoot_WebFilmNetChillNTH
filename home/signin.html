<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- CSS -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/main.css">

	<!-- Favicons -->
	<link rel="icon" type="image/png" href="icon/favicon-32x32.png" sizes="32x32">
	<link rel="apple-touch-icon" href="icon/favicon-32x32.png">

	<meta name="description" content="Online Movies, TV Shows & Cinema HTML Template">
	<title>FlixGo â€“ Online Movies, TV Shows & Cinema HTML Template</title>
</head>

<body>
	<div class="sign section--bg" data-bg="img/bg/section__bg.jpg">
		<div class="container">
			<div class="row">
				<div class="col-12">
					<div class="sign__content">
						<!-- authorization form -->
						<form id="loginForm" class="sign__form" onsubmit="event.preventDefault(); loginUser();">
							<a href="index.html" class="sign__logo">
								<img src="img/logo.png" alt="">
							</a>

							<div class="sign__group">
								<input type="text" id="email" class="sign__input" placeholder="Email" required>
							</div>

							<div class="sign__group">
								<input type="password" id="password" class="sign__input" placeholder="Password"
									required>
							</div>

							<button class="sign__btn" type="submit"><span>Sign in</span></button>

							<span id="errorText" class="text-danger"></span>

							<span class="sign__text">Don't have an account? <a href="signup.html">Sign Up!</a></span>

							<span class="sign__text"><a href="forgot.html">Forgot password?</a></span>
						</form>
						<!-- end authorization form -->
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- JS -->
	<script src="js/bootstrap.bundle.min.js"></script>
	<script src="js/main.js"></script>
	<script src="js/auth.js"></script>
	<script>
		function loginUser() {
			var email = document.getElementById("email").value;
			var password = document.getElementById("password").value;

			var loginRequest = {
				email: email,
				password: password
			};

			fetch('http://localhost:8989/users/login-user', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify(loginRequest),
				})
				.then(response => {
					if (!response.ok) {
						throw new Error('Network response was not ok');
					}
					return response.json();
				})
				.then(data => {
					console.log('Login successful:', data);
					localStorage.setItem('jwtToken', data.token);
					localStorage.setItem('userId', data.id);
					localStorage.setItem('userEmail', data.email);
					localStorage.setItem('userRoles', JSON.stringify(data.roles));
					window.location.href = '/home/index.html';
				})
				.catch(error => {
					console.error('Login error:', error.message);
					document.getElementById('errorText').innerText = 'Login failed: ' + error.message;
				});
		}
	</script>
</body>

</html>